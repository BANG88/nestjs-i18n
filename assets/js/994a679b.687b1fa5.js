"use strict";(self.webpackChunknestjs_i18n=self.webpackChunknestjs_i18n||[]).push([[323],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),l=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(n),m=a,h=d["".concat(p,".").concat(m)]||d[m]||c[m]||o;return n?r.createElement(h,i(i({ref:t},u),{},{components:n})):r.createElement(h,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2524:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return c}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],s={sidebar_position:4},p="GraphQL",l={unversionedId:"guides/graphql",id:"guides/graphql",title:"GraphQL",description:"When using GraphQL nestjs-i18n works out of the box in most cases. With normal requests you can add headers etc. so the resolvers still work like you would expect. But when using GraphQL subscriptions this requires additional steps.",source:"@site/docs/guides/graphql.md",sourceDirName:"guides",slug:"/guides/graphql",permalink:"/nestjs-i18n/guides/graphql",editUrl:"https://github.com/toonvanstrijp/nestjs-i18n/tree/main/docs/guides/graphql.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Plurals",permalink:"/nestjs-i18n/guides/plurals"},next:{title:"DTO validation",permalink:"/nestjs-i18n/guides/dto-validation"}},u={},c=[],d={toc:c};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"graphql"},"GraphQL"),(0,o.kt)("p",null,"When using GraphQL ",(0,o.kt)("inlineCode",{parentName:"p"},"nestjs-i18n")," works out of the box in most cases. With normal requests you can add headers etc. so the resolvers still work like you would expect. But when using GraphQL subscriptions this requires additional steps."),(0,o.kt)("p",null,"To fix this change your ",(0,o.kt)("inlineCode",{parentName:"p"},"GraphQLModule")," configuration."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff",metastring:'title="src/app.module.ts"',title:'"src/app.module.ts"'},"  GraphQLModule.forRoot<ApolloDriverConfig>({\n    driver: ApolloDriver,\n    subscriptions: {\n      'graphql-ws': true,\n    },\n    typePaths: ['*/**/*.graphql'],\n+   context: (ctx) => ctx,\n    path: '/graphql',\n  })\n")),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"It's recommened to use ",(0,o.kt)("inlineCode",{parentName:"p"},"graphql-ws")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"subscriptions-transport-ws")," (",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://github.com/apollographql/subscriptions-transport-ws"},"read more")),"). If you're still using ",(0,o.kt)("inlineCode",{parentName:"p"},"subscriptions-transport-ws")," you should re-configure your ",(0,o.kt)("inlineCode",{parentName:"p"},"GraphQLModule"),"."),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-diff",metastring:'title="src/app.module.ts"',title:'"src/app.module.ts"'},"  GraphQLModule.forRoot<ApolloDriverConfig>({\n    driver: ApolloDriver,\n    subscriptions: {\n+     'subscriptions-transport-ws': {\n+       onConnect: (params) => ({ connectionParams: params }),\n+       path: '/graphql'\n      }\n    },\n    typePaths: ['*/**/*.graphql'],\n+   context: (ctx) => ctx,\n    path: '/graphql',\n  })\n")))),(0,o.kt)("p",null,"After that use the following ",(0,o.kt)("inlineCode",{parentName:"p"},"GraphQLWebsocketResolver")," resolver."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff",metastring:'title="src/app.module.ts"',title:'"src/app.module.ts"'},"  I18nModule.forRoot({\n    fallbackLanguage: 'en',\n    loaderOptions: {\n      path: path.join(__dirname, '/i18n/'),\n      watch: true,\n    },\n    resolvers: [\n+     GraphQLWebsocketResolver,\n      { use: QueryResolver, options: ['lang'] },\n      AcceptLanguageResolver,\n    ],\n  })\n")))}m.isMDXComponent=!0}}]);